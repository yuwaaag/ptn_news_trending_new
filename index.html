<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN AI NEWS LIVE - Studio</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; }
        .studio { position: relative; width: 100vw; height: 100vh; background: url('studio.jpg') center/cover no-repeat; }
        .visual-box { position: absolute; right: 5%; top: 12%; width: 42%; height: 40%; border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; background:#000; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px #00f2ff; }
        #newsImg { width: 100%; height: 100%; object-fit: cover; }
        .script-box { position: absolute; left: 3%; top: 12%; width: 45%; height: 60%; background: rgba(0,0,0,0.85); border-left: 10px solid #f00; padding: 30px; overflow: hidden; }
        #teleprompter { position: absolute; font-size: 32px; line-height: 1.6; top: 100%; font-weight: bold; width: 90%; }
        .anchor-container { position: absolute; right: 0; bottom: 0; width: 65%; height: 100%; display: flex; justify-content: flex-end; align-items: flex-end; pointer-events: none; }
        #anchorCanvas { max-width: 100%; max-height: 100%; }
        #anchorVid { display: none; }
        .ticker-bar { position: absolute; bottom: 0; width: 100%; height: 85px; background: linear-gradient(90deg, #b00, #500); display: flex; align-items: center; border-top: 4px solid #fff; }
        marquee { font-size: 40px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="studio">
        <div class="visual-box"><img id="newsImg" src="https://via.placeholder.com/800x450?text=PTN+AI+NEWS"></div>
        <div class="script-box"><div id="teleprompter">न्यूज़ शुरू करने के लिए यहाँ क्लिक करें...</div></div>
        <div class="anchor-container"><canvas id="anchorCanvas"></canvas></div>
        <video id="anchorVid" muted loop crossorigin="anonymous"><source src="anchor_video.mp4" type="video/mp4"></video>
        <div class="ticker-bar"><marquee id="flashTicker">PTN AI NEWS LIVE: ताज़ा खबरों के लिए बने रहें...</marquee></div>
    </div>

<script>
    // --- यहाँ अपने सही लिंक्स डालें ---
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQIFnU9tSm55lZX2quTdqFsUpdKhc5azTfJ4a3M-x9dJW3Co16AeGuf570dRqdUPkZNju4qvpEGChtS/pub?gid=0&single=true&output=csv";
    const proxyUrl = "https://script.google.com/macros/s/AKfycbxNz2c9z7cZ3gPb-YsJDgHD7MWAL1S-wRAzHHLX6lx-zN0jEISJQM14XuzZ1OOQCAt9mw/exec";

    let newsItems = [], newsIndex = 0;
    const video = document.getElementById("anchorVid");
    const canvas = document.getElementById("anchorCanvas");
    const ctx = canvas.getContext("2d");

    // Chroma Key Processing (Green Screen hatane ke liye)
    function processChroma() {
        if (video.paused || video.ended) return;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let l = frame.data.length / 4;
        for (let i = 0; i < l; i++) {
            let r = frame.data[i * 4 + 0];
            let g = frame.data[i * 4 + 1];
            let b = frame.data[i * 4 + 2];
            // Green screen logic
            if (g > 100 && g > r * 1.2 && g > b * 1.2) {
                frame.data[i * 4 + 3] = 0;
            }
        }
        ctx.putImageData(frame, 0, 0);
        requestAnimationFrame(processChroma);
    }

    async function setPhoto(kw) {
        const img = document.getElementById("newsImg");
        let query = kw ? kw : "news";
        // Default Image
        img.src = `https://loremflickr.com/800/450/${encodeURIComponent(query)}`;
        // Pexels se asli photo lana
        try {
            const res = await fetch(`${proxyUrl}?kw=${encodeURIComponent(query)}`);
            const d = await res.json();
            if(d.url) img.src = d.url;
        } catch(e) { console.log("Photo load error"); }
    }

    async function loadData() {
        try {
            const res = await fetch(csvUrl + "&cachebust=" + Date.now());
            const data = await res.text();
            const rows = data.split('\n').filter(r => r.trim() !== "");
            newsItems = rows.slice(1).map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { 
                    script: (c[0] || "").replace(/"/g,""), 
                    visual: (c[1] || "").replace(/"/g,""), 
                    flash: (c[2] || "").replace(/"/g,"") 
                };
            });
            if(newsItems.length > 0) playNews();
            else alert("शीट खाली है!");
        } catch(e) { alert("Data load error! Check CSV link."); }
    }

    function playNews() {
        if(newsIndex >= newsItems.length) { 
            newsIndex = 0; 
            setTimeout(loadData, 5000); // 5 sec baad nayi news check karo
            return; 
        }

        const item = newsItems[newsIndex];
        const prompter = document.getElementById("teleprompter");

        // UI Reset
        prompter.style.transition = "none";
        prompter.style.top = "100%";
        prompter.innerText = item.script;
        document.getElementById("flashTicker").innerText = item.flash;
        setPhoto(item.visual);

        // Voice Setup
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(item.script);
        msg.lang = 'hi-IN';
        msg.rate = 0.85;

        msg.onstart = () => {
            video.play();
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            processChroma();
            // Teleprompter speed calculate karna (Duration ke hisab se)
            const duration = (item.script.length / 10); 
            setTimeout(() => {
                prompter.style.transition = `top ${duration}s linear`;
                prompter.style.top = "-200%";
            }, 100);
        };

        msg.onend = () => {
            video.pause();
            newsIndex++;
            setTimeout(playNews, 3000); // 3 second ka gap news ke beech
        };

        window.speechSynthesis.speak(msg);
    }

    // Start on click
    window.onclick = () => { 
        if(newsItems.length === 0) {
            document.getElementById("teleprompter").innerText = "लोड हो रहा है...";
            loadData(); 
        }
    };
</script>
</body>
</html>
